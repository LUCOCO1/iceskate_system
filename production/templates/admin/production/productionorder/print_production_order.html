{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div id="content-main" style="width: 800px; margin: 0 auto; padding: 20px;">
    <style>
        @media print {
            .no-print { display: none; }
            body { margin: 0; padding: 0; }
            th { background-color: #f5f5f5 !important; }
            tr:nth-child(even) { background-color: #fafafa !important; }
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 2px solid #000;
        }
        
        .company-name {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }
        
        .doc-title {
            font-size: 22px;
            font-weight: bold;
            letter-spacing: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
            table-layout: fixed;
        }
        
        th, td {
            border: 1px solid #000;
            padding: 12px;
            text-align: center;
            font-size: 14px;
            line-height: 1.4;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: bold;
            width: 100px;
        }
        
        .order-number-cell {
            width: 200px;
        }
        
        .color-cell {
            width: 100px;
        }
        
        tr:nth-child(even) {
            background-color: #fafafa;
        }
        
        .materials-table {
            width: 100%;
            border: 1px solid #000;
            border-collapse: collapse;
            margin-bottom: 25px;
        }
        
        .materials-table th,
        .materials-table td {
            border: 1px solid #000;
            padding: 12px;
            text-align: center;
            font-size: 14px;
        }
        
        .materials-table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        .materials-table tr {
            border: 1px solid #000;
        }
        
        .materials-table th:nth-child(1) { width: 20%; }
        .materials-table th:nth-child(2) { width: 20%; }
        .materials-table th:nth-child(3) { width: 20%; }
        .materials-table th:nth-child(4) { width: 20%; }
        .materials-table th:nth-child(5) { width: 20%; }
        
        h3 {
            margin: 20px 0;
            padding-left: 10px;
            border-left: 4px solid #333;
            font-size: 18px;
        }
        
        .footer {
            margin-top: 50px;
            display: flex;
            justify-content: space-around;
            padding: 20px 0;
            border-top: 1px solid #ccc;
        }
        
        .signature-item {
            flex: 1;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .signature-line {
            border-bottom: 1px solid #000;
            width: 120px;
            display: inline-block;
            margin-left: 10px;
            position: relative;
            height: 20px;
            text-align: center;
        }
        
        .signature-text {
            position: absolute;
            left: 0;
            right: 0;
            top: -10px;
            margin: auto;
            width: 100%;
            text-align: center;
            font-size: 14px;
        }
        
        .print-button {
            padding: 8px 20px;
            margin: 0 10px;
            border: none;
            background-color: #1a73e8;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .print-button:hover {
            background-color: #1557b0;
        }
        
        .material-cell {
            width: 200px;
        }
    </style>

    <div class="print-header">
        <div class="company-name">东莞市伟呈塑胶制品有限公司</div>
        <div class="doc-title">生产单</div>
    </div>

    <table>
        <tr>
            <th>管制单号</th>
            <td class="order-number-cell">{{ order.order_number }}</td>
            <th>采购单号</th>
            <td class="color-cell"></td>
        </tr>
        <tr>
            <th>品名规格</th>
            <td class="order-number-cell">{{ order.product.name }}</td>
            <th>颜色</th>
            <td class="color-cell"></td>
        </tr>
        <tr>
            <th>材料</th>
            <td class="material-cell">3CR13</td>
            <th>单位</th>
            <td>{{ order.product.unit }}</td>
        </tr>
        <tr>
            <th>数量</th>
            <td>{{ order.planned_quantity }}</td>
            <th>下单日期</th>
            <td>{{ order.created_at|date:"Y-m-d" }}</td>
        </tr>
    </table>

    <h3>材料需求</h3>
    <table class="materials-table">
        <thead>
            <tr>
                <th>材料</th>
                <th>需求数量</th>
                <th>单位</th>
                <th>实际领用</th>
                <th>备注</th>
            </tr>
        </thead>
        <tbody>
            {% for requirement in order.material_requirements.all %}
            <tr>
                <td>{{ requirement.material.name }}</td>
                <td>{{ requirement.required_quantity }}</td>
                <td>{{ requirement.material.unit }}</td>
                <td>{{ requirement.actual_quantity }}</td>
                <td>{{ requirement.notes }}</td>
            </tr>
            {% endfor %}
            {% if not order.material_requirements.all %}
            <tr>
                <td colspan="5" style="text-align: center; padding: 20px;">暂无材料需求记录</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <div class="footer">
        <div class="signature-item">
            主管：<span class="signature-line"></span>
        </div>
        <div class="signature-item">
            审核：<span class="signature-line">
                <div class="signature-text">卢瑶</div>
            </span>
        </div>
        <div class="signature-item">
            制表人：<span class="signature-line">
                <div class="signature-text">周赛柳</div>
            </span>
        </div>
    </div>

    <div class="no-print" style="margin-top: 30px; text-align: center;">
        <button class="print-button" onclick="window.print()">打印</button>
        <button class="print-button" onclick="window.close()">关闭</button>
    </div>
</div>
{% endblock %} 